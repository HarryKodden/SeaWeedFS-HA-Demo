<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Master 3 Details - SeaweedFS</title>
    <link rel="stylesheet" href="/seaweedfsstatic/bootstrap/3.3.1/css/bootstrap.min.css">
    <style>
        body {
            font-family: Arial, sans-serif;
            line-height: 1.6;
            color: #333;
            padding: 20px;
            background-color: #f7f9fc;
        }
        h1 {
            color: #2c3e50;
            border-bottom: 2px solid #3498db;
            padding-bottom: 10px;
        }
        .panel {
            margin-bottom: 20px;
            background-color: white;
            border-radius: 4px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .panel-heading {
            background-color: #f5f5f5;
            border-bottom: 1px solid #ddd;
            padding: 15px;
        }
        .panel-body {
            padding: 15px;
        }
        .stat-value {
            font-weight: bold;
            font-size: 16px;
        }
        .table {
            margin-bottom: 0;
        }
        .progress {
            margin-bottom: 10px;
        }
        .back-link {
            margin-bottom: 20px;
            display: inline-block;
        }
        .master-info {
            margin-bottom: 20px;
        }
        .raw-api-links {
            margin-top: 30px;
            padding: 15px;
            background-color: #f9f9f9;
            border-radius: 4px;
        }
        .leader-badge {
            background-color: #5cb85c;
            color: white;
            padding: 4px 8px;
            border-radius: 4px;
            margin-left: 10px;
            font-size: 12px;
        }
        .follower-badge {
            background-color: #f0ad4e;
            color: white;
            padding: 4px 8px;
            border-radius: 4px;
            margin-left: 10px;
            font-size: 12px;
        }
        .health-indicator {
            display: inline-block;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            margin-right: 5px;
        }
        .health-good {
            background-color: #5cb85c;
        }
        .health-warning {
            background-color: #f0ad4e;
        }
        .health-critical {
            background-color: #d9534f;
        }
        .topology-tree ul {
            list-style-type: none;
            padding-left: 20px;
        }
        .topology-tree > ul {
            padding-left: 0;
        }
        .node-type {
            font-weight: bold;
            color: #3498db;
        }
        .cluster-member {
            margin-bottom: 10px;
            padding: 10px;
            border: 1px solid #eee;
            border-radius: 4px;
        }
    </style>
</head>
<body>
    <div class="container">
        <a href="/" class="back-link">‚Üê Back to Dashboard</a>
        
        <h1>
            <img src="/seaweedfsstatic/seaweed50x50.png" alt="SeaweedFS Logo"> 
            Master Server 3 <span class="follower-badge">Follower</span>
        </h1>
        
        <div class="row master-info">
            <div class="col-md-12">
                <div class="alert alert-info">
                    <strong>Master Server Info:</strong> Data Center: DefaultDataCenter, Running since: <span id="uptime">Loading...</span>
                </div>
            </div>
        </div>

        <div class="row">
            <div class="col-md-6">
                <div class="panel panel-default">
                    <div class="panel-heading">
                        <h3 class="panel-title">Cluster Status</h3>
                    </div>
                    <div class="panel-body">
                        <table class="table table-bordered">
                            <tr>
                                <td>Volume Size Limit:</td>
                                <td class="stat-value">1024 MB</td>
                            </tr>
                            <tr>
                                <td>Free Volumes:</td>
                                <td class="stat-value" id="free-volumes">Loading...</td>
                            </tr>
                            <tr>
                                <td>Max Volumes:</td>
                                <td class="stat-value" id="max-volumes">Loading...</td>
                            </tr>
                            <tr>
                                <td>Total Size:</td>
                                <td class="stat-value" id="total-size">Loading...</td>
                            </tr>
                            <tr>
                                <td>Used Size:</td>
                                <td class="stat-value" id="used-size">Loading...</td>
                            </tr>
                        </table>
                        
                        <h4>Storage Usage</h4>
                        <div class="progress">
                            <div id="storage-usage-bar" class="progress-bar" role="progressbar" 
                                 aria-valuenow="0" aria-valuemin="0" aria-valuemax="100" style="width: 0%">
                                0%
                            </div>
                        </div>
                    </div>
                </div>

                <div class="panel panel-default">
                    <div class="panel-heading">
                        <h3 class="panel-title">Topology</h3>
                    </div>
                    <div class="panel-body topology-tree">
                        <ul id="topology">
                            <li>
                                <span class="node-type">Data Center:</span> DefaultDataCenter
                                <ul>
                                    <li>
                                        <span class="node-type">Rack:</span> Rack1
                                        <ul>
                                            <li><span class="health-indicator health-good"></span> Volume Server 1</li>
                                        </ul>
                                    </li>
                                    <li>
                                        <span class="node-type">Rack:</span> Rack2
                                        <ul>
                                            <li><span class="health-indicator health-good"></span> Volume Server 2</li>
                                        </ul>
                                    </li>
                                    <li>
                                        <span class="node-type">Rack:</span> Rack3
                                        <ul>
                                            <li><span class="health-indicator health-good"></span> Volume Server 3</li>
                                        </ul>
                                    </li>
                                </ul>
                            </li>
                        </ul>
                    </div>
                </div>
            </div>

            <div class="col-md-6">
                <div class="panel panel-default">
                    <div class="panel-heading">
                        <h3 class="panel-title">Cluster Members</h3>
                    </div>
                    <div class="panel-body">
                        <div class="cluster-member">
                            <h4><span class="health-indicator health-good"></span> Master 1 
                                <span class="leader-badge">Leader</span>
                            </h4>
                            <p>URL: <a href="/master/1/">master1:9333</a></p>
                            <p>Status: Active (handling requests)</p>
                        </div>
                        
                        <div class="cluster-member">
                            <h4><span class="health-indicator health-good"></span> Master 2
                                <span class="follower-badge">Follower</span>
                            </h4>
                            <p>URL: <a href="/master/2/">master2:9333</a></p>
                            <p>Status: Active (standby)</p>
                        </div>
                        
                        <div class="cluster-member">
                            <h4><span class="health-indicator health-good"></span> Master 3
                                <span class="follower-badge">Follower</span>
                            </h4>
                            <p>URL: <a href="/master/3/">master3:9333</a></p>
                            <p>Status: Active (standby)</p>
                        </div>
                    </div>
                </div>

                <div class="panel panel-default">
                    <div class="panel-heading">
                        <h3 class="panel-title">System Resources</h3>
                    </div>
                    <div class="panel-body">
                        <h4>CPU Usage</h4>
                        <div class="progress">
                            <div id="cpu-usage-bar" class="progress-bar progress-bar-info" role="progressbar" 
                                 aria-valuenow="0" aria-valuemin="0" aria-valuemax="100" style="width: 0%">
                                0%
                            </div>
                        </div>
                        
                        <h4>Memory Usage</h4>
                        <div class="progress">
                            <div id="memory-usage-bar" class="progress-bar progress-bar-warning" role="progressbar" 
                                 aria-valuenow="0" aria-valuemin="0" aria-valuemax="100" style="width: 0%">
                                0%
                            </div>
                        </div>
                        
                        <table class="table table-bordered">
                            <tr>
                                <td>Goroutines:</td>
                                <td class="stat-value" id="goroutines">Loading...</td>
                            </tr>
                            <tr>
                                <td>Open Connections:</td>
                                <td class="stat-value" id="open-connections">Loading...</td>
                            </tr>
                        </table>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="row">
            <div class="col-md-12">
                <div class="panel panel-default">
                    <div class="panel-heading">
                        <h3 class="panel-title">Recent Operations</h3>
                    </div>
                    <div class="panel-body">
                        <table class="table table-striped" id="operations-list">
                            <thead>
                                <tr>
                                    <th>Time</th>
                                    <th>Operation</th>
                                    <th>Details</th>
                                    <th>Status</th>
                                </tr>
                            </thead>
                            <tbody id="operations-list-body">
                                <tr>
                                    <td colspan="4" class="text-center">Loading operations data...</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="raw-api-links">
            <h4>API Links:</h4>
            <ul>
                <li><a href="/master/3/status" target="_blank">/master/3/status</a> - Master Server Status</li>
                <li><a href="/master/3/cluster/status" target="_blank">/master/3/cluster/status</a> - Cluster Status</li>
                <li><a href="/master/3/dir/status" target="_blank">/master/3/dir/status</a> - Directory Status</li>
                <li><a href="/master/3/vol/status" target="_blank">/master/3/vol/status</a> - Volume Status</li>
            </ul>
        </div>
    </div>
    
    <script>
        // This would ideally use the real SeaweedFS API to populate data
        // For now, we'll simulate it with some random data
        
        function formatSize(bytes) {
            if (bytes === 0) return '0 Bytes';
            const k = 1024;
            const sizes = ['Bytes', 'KB', 'MB', 'GB', 'TB'];
            const i = Math.floor(Math.log(bytes) / Math.log(k));
            return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
        }
        
        function randomInt(min, max) {
            return Math.floor(Math.random() * (max - min + 1) + min);
        }
        
        function formatDate(date) {
            return date.toLocaleDateString() + ' ' + date.toLocaleTimeString();
        }
        
        function getUptime() {
            // Generate a random start date between 30-90 days ago
            const now = new Date();
            const startDate = new Date(now.getTime() - randomInt(30, 90) * 24 * 60 * 60 * 1000);
            
            // Calculate difference in days
            const diffTime = Math.abs(now - startDate);
            const diffDays = Math.floor(diffTime / (1000 * 60 * 60 * 24));
            
            return diffDays + ' days, ' + randomInt(1, 23) + ' hours, ' + randomInt(1, 59) + ' minutes';
        }
        
        function fetchMasterStatus() {
            // In a real implementation, this would fetch data from the SeaweedFS API
            // For this demo, we'll use simulated data
            
            // Update uptime
            document.getElementById('uptime').innerText = getUptime();
            
            // Cluster status
            const freeVolumes = randomInt(10, 15);
            const maxVolumes = 15;
            const totalSize = 1024 * 1024 * 1024 * 150; // 150 GB
            const usedSize = randomInt(20, 80) * 1024 * 1024 * 1024; // 20-80 GB
            
            document.getElementById('free-volumes').innerText = freeVolumes;
            document.getElementById('max-volumes').innerText = maxVolumes;
            document.getElementById('total-size').innerText = formatSize(totalSize);
            document.getElementById('used-size').innerText = formatSize(usedSize);
            
            // Update storage usage bar
            const usagePercent = Math.floor((usedSize / totalSize) * 100);
            const storageUsageBar = document.getElementById('storage-usage-bar');
            storageUsageBar.style.width = usagePercent + '%';
            storageUsageBar.innerText = usagePercent + '%';
            storageUsageBar.setAttribute('aria-valuenow', usagePercent);
            
            // Set appropriate color based on usage
            if (usagePercent < 50) {
                storageUsageBar.className = 'progress-bar progress-bar-success';
            } else if (usagePercent < 80) {
                storageUsageBar.className = 'progress-bar progress-bar-warning';
            } else {
                storageUsageBar.className = 'progress-bar progress-bar-danger';
            }
            
            // System resource usage
            const cpuUsage = randomInt(1, 10); // Follower uses less CPU
            const memoryUsage = randomInt(15, 40); // Follower uses less memory
            const goroutines = randomInt(25, 100); // Follower has fewer goroutines
            const openConnections = randomInt(2, 20); // Follower has fewer connections
            
            const cpuUsageBar = document.getElementById('cpu-usage-bar');
            cpuUsageBar.style.width = cpuUsage + '%';
            cpuUsageBar.innerText = cpuUsage + '%';
            cpuUsageBar.setAttribute('aria-valuenow', cpuUsage);
            
            const memoryUsageBar = document.getElementById('memory-usage-bar');
            memoryUsageBar.style.width = memoryUsage + '%';
            memoryUsageBar.innerText = memoryUsage + '%';
            memoryUsageBar.setAttribute('aria-valuenow', memoryUsage);
            
            document.getElementById('goroutines').innerText = goroutines;
            document.getElementById('open-connections').innerText = openConnections;
            
            // Generate recent operations
            const operationsListBody = document.getElementById('operations-list-body');
            let operationsHTML = '';
            
            const operationTypes = [
                'Heartbeat', 
                'Metadata Sync',
                'Leader Election',
                'System Maintenance',
                'Topology Update'
            ];
            
            const operationStatuses = [
                '<span class="label label-success">Success</span>',
                '<span class="label label-success">Success</span>',
                '<span class="label label-success">Success</span>',
                '<span class="label label-warning">Warning</span>',
                '<span class="label label-danger">Failed</span>'
            ];
            
            const now = new Date();
            
            for (let i = 0; i < 10; i++) {
                const opType = operationTypes[Math.floor(Math.random() * operationTypes.length)];
                const opStatus = operationStatuses[Math.floor(Math.random() * operationStatuses.length)];
                
                // Generate a random time in the past hour
                const opTime = new Date(now.getTime() - randomInt(1, 60) * 60 * 1000);
                
                let details;
                switch (opType) {
                    case 'Heartbeat':
                        details = 'Sent heartbeat to leader (master1)';
                        break;
                    case 'Metadata Sync':
                        details = 'Synced metadata from leader';
                        break;
                    case 'Leader Election':
                        details = 'Participated in leader election, master1 elected as leader';
                        break;
                    case 'System Maintenance':
                        details = 'Performed routine system maintenance';
                        break;
                    case 'Topology Update':
                        details = 'Received topology update from leader';
                        break;
                }
                
                operationsHTML += `
                <tr>
                    <td>${formatDate(opTime)}</td>
                    <td>${opType}</td>
                    <td>${details}</td>
                    <td>${opStatus}</td>
                </tr>`;
            }
            
            operationsListBody.innerHTML = operationsHTML;
        }
        
        // Call once on page load
        fetchMasterStatus();
        
        // Then refresh every 30 seconds
        setInterval(fetchMasterStatus, 30000);
    </script>
</body>
</html>
